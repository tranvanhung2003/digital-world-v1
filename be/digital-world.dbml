Table dia_chi {
  id uuid [pk]
  nguoi_dung_id uuid [not null, ref: > nguoi_dung.id]
  ten_nguoi_nhan string
  ten string [not null]
  ho string [not null]
  cong_ty string
  dia_chi_1 string [not null]
  dia_chi_2 string
  quan_huyen string [not null]
  tinh_thanh string [not null]
  ma_buu_dien string [not null]
  quoc_gia string [not null]
  so_dien_thoai string
  mac_dinh boolean [not null, default: false]
}

Table nhom_thuoc_tinh {
  id uuid [pk]
  ten_nhom_thuoc_tinh string [not null]
  mo_ta string
  loai_thuoc_tinh enum [not null, default: 'custom', note: '''
    color
    config
    storage
    size
    custom
  ''']
  bat_buoc boolean [not null, default: false]
  thu_tu_hien_thi int [not null, default: 0]
  dang_hoat_dong boolean [not null, default: true]
}

Table gia_tri_thuoc_tinh {
  id uuid [pk]
  nhom_thuoc_tinh_id uuid [not null, ref: > nhom_thuoc_tinh.id]
  ten_gia_tri_thuoc_tinh string [not null]
  gia_tri_thuoc_tinh string [not null]
  ma_mau string
  url_hinh_anh string
  chinh_sua_gia decimal(12,2)
  thu_tu_hien_thi int
  dang_hoat_dong boolean
  anh_huong_ten_san_pham boolean
  mau_ten_san_pham string
}

Table gio_hang {
  id uuid [pk]
  nguoi_dung_id uuid [ref: > nguoi_dung.id]
  session_id string
  trang_thai enum [not null, default: 'active', note: '''
    active
    merged
    converted
    abandoned
  ''']
}

Table chi_tiet_gio_hang {
  id uuid [pk]
  gio_hang_id uuid [not null, ref: > gio_hang.id]
  san_pham_id uuid [not null, ref: > san_pham.id]
  bien_the_id uuid [ref: > bien_the.id]
  so_luong int [not null, default: 1]
  gia decimal(19,2) [not null]
  goi_bao_hanh_ids array(uuid) [not null, default: `[]`]
}

Table danh_muc {
  id uuid [pk]
  ten_danh_muc string [not null]
  slug string [not null, unique]
  mo_ta string
  hinh_anh string
  danh_muc_cha_id uuid [ref: > danh_muc.id]
  cap_do int [not null, default: 1]
  dang_hoat_dong boolean [not null, default: true]
  thu_tu_hien_thi int [not null, default: 0]
}

Table phan_hoi {
  id uuid [pk]
  ten_nguoi_gui string [not null]
  email_nguoi_gui string [not null]
  so_dien_thoai string
  tieu_de string [not null]
  noi_dung string [not null]
  trang_thai enum [not null, default: 'pending', note: '''
    pending
    reviewed
    resolved
  ''']
}

Table hinh_anh {
  id uuid [pk]
  ten_goc string [not null]
  ten_file string [not null, unique]
  duong_dan_file string [not null]
  kich_thuoc_file int [not null]
  loai_mime string [not null]
  chieu_rong int
  chieu_cao int
  danh_muc enum [not null, default: 'product', note: '''
    product
    thumbnail
    user
    review
  ''']
  san_pham_id uuid [ref: > san_pham.id]
  nguoi_dung_id uuid [ref: > nguoi_dung.id]
  dang_hoat_dong boolean [not null, default: true]

  indexes {
    san_pham_id
    nguoi_dung_id
    danh_muc
    dang_hoat_dong
  }
}

Table tin_tuc {
  id uuid [pk]
  tieu_de string [not null]
  slug string [not null, unique]
  noi_dung string [not null]
  thumbnail string
  mo_ta string
  danh_muc string [not null, default: 'Tin tá»©c']
  luot_xem int [not null, default: 0]
  tu_khoa string
  da_xuat_ban boolean [not null, default: true]
  nguoi_dung_id uuid [ref: > nguoi_dung.id]
}

Table nguoi_dang_ky_ban_tin {
  id uuid [pk]
  email string [not null, unique]
  trang_thai enum [not null, default: 'active', note: '''
    active
    unsubscribed
  ''']
}

Table don_hang {
  id uuid [pk]
  ma_don_hang string [not null, unique]
  nguoi_dung_id uuid [not null, ref: > nguoi_dung.id]
  trang_thai enum [not null, default: 'pending', note:'''
    pending
    processing
    shipped
    delivered
    cancelled
  ''']
  ten_nguoi_nhan string [not null]
  ho_nguoi_nhan string [not null]
  cong_ty_nguoi_nhan string
  dia_chi_nguoi_nhan_1 string [not null]
  dia_chi_nguoi_nhan_2 string
  quan_huyen_nguoi_nhan string [not null]
  tinh_thanh_nguoi_nhan string [not null]
  ma_buu_dien_nguoi_nhan string [not null]
  quoc_gia_nguoi_nhan string [not null]
  so_dien_thoai_nguoi_nhan string
  ten_nguoi_thanh_toan string [not null]
  ho_nguoi_thanh_toan string [not null]
  cong_ty_nguoi_thanh_toan string
  dia_chi_nguoi_thanh_toan_1 string [not null]
  dia_chi_nguoi_thanh_toan_2 string
  quan_huyen_nguoi_thanh_toan string [not null]
  tinh_thanh_nguoi_thanh_toan string [not null]
  ma_buu_dien_nguoi_thanh_toan string [not null]
  quoc_gia_nguoi_thanh_toan string [not null]
  so_dien_thoai_nguoi_thanh_toan string
  phuong_thuc_thanh_toan string [not null]
  trang_thai_thanh_toan enum [not null, default: 'pending', note: '''
    pending
    paid
    failed
    refunded
  ''']
  ma_giao_dich_thanh_toan string
  nha_cung_cap_thanh_toan string
  tong_phu decimal(19,2) [not null]
  thue decimal(19,2) [not null]
  phi_van_chuyen decimal(19,2) [not null]
  giam_gia decimal(19,2) [not null, default: 0]
  tong_tien decimal(19,2) [not null]
  ghi_chu string
  ma_theo_doi string
  nha_cung_cap_van_chuyen string
  ngay_giao_du_kien timestamp 
}

Table chi_tiet_don_hang {
  id uuid [pk]
  don_hang_id uuid [not null, ref: > don_hang.id]
  san_pham_id uuid [not null, ref: > san_pham.id]
  bien_the_id uuid [ref: > bien_the.id]
  ten_san_pham string [not null]
  ma_sku string
  gia decimal(19,2) [not null]
  so_luong int [not null]
  tong_phu decimal(19,2) [not null]
  hinh_anh string
  thuoc_tinh jsonb [not null, default: `{}`]
}

Table san_pham {
  id uuid [pk]
  ten_san_pham string [not null]
  slug string [not null, unique]
  mo_ta string [not null]
  mo_ta_ngan string [not null]
  gia decimal(12,2) [not null]
  gia_goc decimal(12,2)
  anh_san_pham string [not null, default: '[]']
  thumbnail string
  con_hang boolean [not null, default: true]
  so_luong_ton_kho int [not null, default: 0]
  ma_sku string [unique]
  trang_thai enum [not null, default: 'active', note: '''
    active
    inactive
    draft
  ''']
  noi_bat boolean [not null, default: false]
  tu_khoa_tim_kiem string [not null, default: '[]']
  tieu_de_seo string
  mo_ta_seo string
  tu_khoa_seo string [not null, default: '[]']
  thong_so_ky_thuat string [not null, default: '[]']
  tinh_trang enum [not null, default: 'new', note: '''
    new
    like-new
    used
    refurbished
  ''']
  ten_co_so string
  la_san_pham_co_bien_the boolean [not null, default: false]
  cau_hoi_thuong_gap string [not null, default: '[]']
}

Table thuoc_tinh {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  ten_thuoc_tinh string [not null]
  loai_thuoc_tinh enum [not null, default: 'custom', note: '''
    color
    size
    material
    custom
  ''']
  gia_tri_thuoc_tinh jsonb [not null, default: `[]`]
  bat_buoc boolean [not null, default: false]
  thu_tu_hien_thi int [not null, default: 0]
}

Table san_pham_nhom_thuoc_tinh {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  nhom_thuoc_tinh_id uuid [not null, ref: > nhom_thuoc_tinh.id]
  bat_buoc boolean [not null, default: false]
  thu_tu_hien_thi int [not null, default: 0]
}

Table san_pham_danh_muc {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  danh_muc_id uuid [not null, ref: > danh_muc.id]

  indexes {
    (san_pham_id, danh_muc_id) [unique]
  }
}

Table san_pham_thong_so_ky_thuat {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  ten_thong_so_ky_thuat string [not null]
  gia_tri_thong_so_ky_thuat string [not null]
  danh_muc string [not null, default: 'General']
  thu_tu_hien_thi int [not null, default: 0]
}

Table bien_the {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  ten_bien_the string [not null]
  ma_sku string
  thuoc_tinh jsonb [not null, default: `{}`]
  thuoc_tinh_phan_cap jsonb [not null, default: `{}`]
  gia decimal(12,2) [not null]
  so_luong_ton_kho int [not null, default: 0]
  hinh_anh array(string) [not null, default: `[]`]
  ten_hien_thi string
  thu_tu_hien_thi int [not null, default: 0]
  mac_dinh boolean [not null, default: false]
  kha_dung boolean [not null, default: true]
  gia_so_sanh decimal(12,2)
  thong_so_ky_thuat jsonb [not null, default: `{}`]
}

Table san_pham_goi_bao_hanh {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  goi_bao_hanh_id uuid [not null, ref: > goi_bao_hanh.id]
  mac_dinh boolean [not null, default: false]
}

Table danh_gia {
  id uuid [pk]
  san_pham_id uuid [not null, ref: > san_pham.id]
  nguoi_dung_id uuid [not null, ref: > nguoi_dung.id]
  muc_danh_gia int [not null]
  tieu_de string
  noi_dung string [not null]
  da_xac_minh boolean [not null, default: false]
  luot_thich int [not null, default: 0]
  luot_khong_thich int [not null, default: 0]
  hinh_anh array(string) [not null, default: `[]`]
}

Table danh_gia_phan_hoi {
  id uuid [pk]
  danh_gia_id uuid [not null, ref: > danh_gia.id]
  nguoi_dung_id uuid [not null, ref: > nguoi_dung.id]
  co_huu_ich boolean [not null]

  indexes {
    (danh_gia_id, nguoi_dung_id) [unique]
  }
}

Table nguoi_dung {
  id uuid [pk]
  email string [not null, unique]
  mat_khau string [not null]
  ten_nguoi_dung string [not null]
  ho_nguoi_dung string [not null]
  so_dien_thoai string
  anh_dai_dien string
  vai_tro enum [not null, default: 'customer', note: '''
    customer
    admin
    manager
  ''']
  da_xac_minh_email boolean [not null, default: false]
  dang_hoat_dong boolean [not null, default: true]
  ma_xac_minh_email string
  ma_dat_lai_mat_khau string
  het_han_dat_lai_mat_khau datetime
  khach_hang_stripe_id string
}

Table goi_bao_hanh {
  id uuid [pk]
  ten_goi_bao_hanh string [not null]
  mo_ta string
  so_thang_bao_hanh int [not null]
  gia decimal(12,2) [not null, default: 0]
  dieu_khoan jsonb [not null, default: `{}`]
  pham_vi_bao_hanh array(string) [not null, default: `[]`]
  dang_hoat_dong boolean [not null, default: true]
  thu_tu_hien_thi int [not null, default: 0]
}

Table san_pham_yeu_thich {
  id uuid [pk]
  nguoi_dung_id uuid [not null, ref: > nguoi_dung.id]
  san_pham_id uuid [not null, ref: > san_pham.id]

  indexes {
    (nguoi_dung_id, san_pham_id) [unique]
  }
}